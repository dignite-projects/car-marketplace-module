<form nz-form #guess="ngForm">
    <div page>
        <div class="site-page-header-ghost-wrapper">
            <nz-page-header [nzGhost]="false" nzBackIcon>
                <nz-page-header-title>二手车</nz-page-header-title>
                <nz-page-header-extra>
                    <nz-space>
                        <button *nzSpaceItem nz-button nzType="primary" (click.stop)="submitCreate()"
                            [disabled]="!(guess.valid&&VerifyImageIAOboolisnull()&&CarCreateGroup.tags.length>0)">
                            提交
                        </button>
                    </nz-space>
                </nz-page-header-extra>
            </nz-page-header>
        </div>
        <div class="site_box" content>
            <div class="site_content">
                <div class="siteflex">
                    <nz-form-item>
                        <nz-form-label [nzSpan]="24" nzFor="brandID" nzRequired>品牌</nz-form-label>
                        <nz-form-control [nzErrorTip]="combineTpl">
                            <nz-select nzShowSearch nzPlaceHolder="请选择品牌" (ngModelChange)="BrandChange($event)"
                                nzRequired required [(ngModel)]="brandID" name="brandID">
                                <ng-container *ngFor="let item of brandList">
                                    <nz-option [nzLabel]="item.firstLetter+' '+item.name" [nzValue]="item.id"
                                        *ngIf="item.name && item.id">{{
                                        item.name
                                        }}</nz-option>
                                </ng-container>
                            </nz-select>
                        </nz-form-control>
                    </nz-form-item>
                    <nz-form-item>
                        <nz-form-label [nzSpan]="24" nzFor="modelID" nzRequired>车型</nz-form-label>
                        <nz-form-control [nzErrorTip]="combineTpl">
                            <nz-select nzShowSearch [nzPlaceHolder]="brandID ? '请选择车型' : '请先选择品牌'"
                                (ngModelChange)="ModelChange($event)" nzRequired required [(ngModel)]="modelID"
                                name="modelID">
                                <ng-container *ngFor="let elm of modelList">
                                    <nz-option-group [nzLabel]="elm.name">
                                        <ng-container *ngFor="let item of elm.models">
                                            <nz-option [nzLabel]="item.name" [nzValue]="item.id"
                                                *ngIf="item.name && item.id">{{
                                                item.name
                                                }}</nz-option>
                                        </ng-container>
                                    </nz-option-group>
                                </ng-container>
                            </nz-select>
                        </nz-form-control>
                    </nz-form-item>
                    <nz-form-item>
                        <nz-form-label [nzSpan]="24" nzFor="trimId" nzRequired>车款</nz-form-label>
                        <nz-form-control [nzErrorTip]="combineTpl">
                            <nz-select nzShowSearch [nzPlaceHolder]="modelID ? '请选择车款' : '请先选择车型'"
                                [(ngModel)]="CarCreateGroup.trimId" (ngModelChange)="trimChange($event)" name="trimId"
                                nzRequired required>
                                <ng-container *ngFor="let elm of trimList">
                                    <nz-option-group [nzLabel]="elm.group">
                                        <ng-container *ngFor="let item of elm.children">
                                            <nz-option [nzLabel]="item.name" [nzValue]="item.id"
                                                *ngIf="item.name && item.id">{{
                                                item.name
                                                }}</nz-option>
                                        </ng-container>
                                    </nz-option-group>
                                </ng-container>
                            </nz-select>
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <nz-form-item>
                    <nz-form-label [nzSpan]="24" nzFor="name" nzRequired>名称</nz-form-label>
                    <nz-form-control [nzErrorTip]="combineTpl">
                        <input nz-input [(ngModel)]="CarCreateGroup.name" nzStatus="error" name="name" type="text"
                            placeholder="请填写名称" required>
                    </nz-form-control>
                </nz-form-item>
                <nz-form-item>
                    <nz-form-label [nzSpan]="24" nzFor="trimId" nzRequired>标签</nz-form-label>
                    <nz-form-control [nzErrorTip]="combineTpl">
                        <div class="margin-lr-xs">
                            <ng-container *ngFor="let item of CarCreateGroup.tags">
                                <nz-tag nzMode="closeable" [nzChecked]="true" [nzColor]="'blue'"
                                    (nzOnClose)="checkClose(item)">{{item}}</nz-tag>
                            </ng-container>
                        </div>
                        <div class="margin-lr-xs" style="margin: 10px 20px !important;">
                            <div style="margin: 10px auto;">预设：</div>
                            <div>
                                <ng-container *ngFor="let item of TagsList; let i=index">
                                    <nz-tag (click.stop)="checkChange(item)" (nzOnClose)="storageClose(item)"
                                        [nzMode]="!TagsListyushe.includes(item)?'closeable':''">{{item}}</nz-tag>
                                </ng-container>
                                <nz-tag *ngIf="!taInputVisible" class="editable-tag" nzNoAnimation
                                    (click.stop)="showInput()">
                                    <span nz-icon nzType="plus"></span>
                                    新建标签
                                </nz-tag>
                                <input #inputElement nz-input nzSize="small" *ngIf="taInputVisible" type="text"
                                    [(ngModel)]="tagInputValue" name="Addtag" style="width: 78px;"
                                    (blur)="handleInputConfirm()" (keydown.enter)="handleInputConfirm()" />
                            </div>
                        </div>
                    </nz-form-control>
                </nz-form-item>
                <nz-form-item>
                    <nz-form-label [nzSpan]="24" nzFor="status" nzRequired>车辆状态</nz-form-label>
                    <nz-form-control [nzErrorTip]="combineTpl">

                        <nz-radio-group [(ngModel)]="CarCreateGroup.status" name="status" nzRequired required>
                            <ng-container *ngFor="let item of carStatusList">
                                <nz-option [nzLabel]="item.displayName" [nzValue]="item.value">{{
                                    item.displayName
                                    }}</nz-option>
                                <label nz-radio [nzValue]="item.value">{{item.displayName}}</label>
                            </ng-container>
                        </nz-radio-group>

                    </nz-form-control>
                </nz-form-item>
                <!-- <div class="">
                    
                </div> -->

                <div class="siteflex w25">
                    <nz-form-item>
                        <nz-form-label [nzSpan]="24" nzFor="color" nzRequired>车辆颜色</nz-form-label>
                        <nz-form-control [nzErrorTip]="combineTpl">
                            <nz-select nzShowSearch nzAllowClear nzPlaceHolder="请选择车辆颜色"
                                [(ngModel)]="CarCreateGroup.color" name="color" required>
                                <ng-container *ngFor="let item of CarColorList">
                                    <nz-option [nzLabel]="item.key" [nzValue]="item.key"></nz-option>
                                </ng-container>
                            </nz-select>
                        </nz-form-control>
                    </nz-form-item>
                    <nz-form-item>
                        <nz-form-label [nzSpan]="24" nzFor="price" nzRequired>价格</nz-form-label>
                        <nz-form-control [nzErrorTip]="combineTpl">
                            <input nz-input [(ngModel)]="CarCreateGroup.price" nzStatus="error" name="price" type="text"
                                placeholder="请填写名称" required>
                        </nz-form-control>
                    </nz-form-item>
                    <nz-form-item>
                        <nz-form-label [nzSpan]="24" nzFor="totalMileage" nzRequired>总里程(公里)</nz-form-label>
                        <nz-form-control [nzErrorTip]="combineTpl">
                            <nz-input-number field [(ngModel)]="CarCreateGroup.totalMileage" [nzMin]="0"
                                name="totalMileage" nzPlaceHolder="总里程" required></nz-input-number>
                        </nz-form-control>
                    </nz-form-item>
                    <nz-form-item>
                        <nz-form-label [nzSpan]="24" nzFor="transfersCount" nzRequired>过户次数</nz-form-label>
                        <nz-form-control [nzErrorTip]="combineTpl">
                            <nz-input-number field [(ngModel)]="CarCreateGroup.transfersCount" [nzMin]="1"
                                name="transfersCount" nzPlaceHolder="请填写过户次数" required [nzStep]="1"></nz-input-number>
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <div class="siteflex">
                    <nz-form-item>
                        <nz-form-label [nzSpan]="24" nzFor="registrationDate" nzRequired>初次上牌日期</nz-form-label>
                        <nz-form-control [nzErrorTip]="combineTpl">
                            <nz-date-picker field [(ngModel)]="CarCreateGroup.registrationDate" name="registrationDate"
                                required></nz-date-picker>
                        </nz-form-control>
                    </nz-form-item>
                    <nz-form-item>
                        <nz-form-label [nzSpan]="24" nzFor="compulsoryInsuranceExpirationDate">交强险过期日期</nz-form-label>
                        <nz-form-control [nzErrorTip]="combineTpl">
                            <nz-date-picker field [(ngModel)]="CarCreateGroup.compulsoryInsuranceExpirationDate"
                                name="compulsoryInsuranceExpirationDate"></nz-date-picker>
                        </nz-form-control>
                    </nz-form-item>
                    <nz-form-item>
                        <nz-form-label [nzSpan]="24" nzFor="commercialInsuranceExpirationDate">商业险过期日期</nz-form-label>
                        <nz-form-control [nzErrorTip]="combineTpl">
                            <nz-date-picker field [(ngModel)]="CarCreateGroup.commercialInsuranceExpirationDate"
                                name="commercialInsuranceExpirationDate"></nz-date-picker>
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <nz-form-item>
                    <nz-form-label [nzSpan]="24" nzFor="description">车辆描述情况</nz-form-label>
                    <nz-form-control [nzErrorTip]="combineTpl">
                        <textarea rows="4" nz-input [(ngModel)]="CarCreateGroup.description" name="description"
                            placeholder="车辆描述情况"></textarea>
                    </nz-form-control>
                </nz-form-item>
                <div class=" imageflex">
                    <ng-container *ngFor="let item of fileCells">
                        <nz-form-item>
                            <nz-form-label [nzSpan]="24" nzFor="image1" nzRequired>{{item.displayName}}</nz-form-label>
                            <nz-form-control [nzErrorTip]="combineTpl">
                                <div class="clearfix">
                                    <div class="upload_box">
                                        <div class="upload_body upload_view"
                                            *ngFor="let elf of item.fileList; let fi=index">
                                            <img [src]="elf.src" class="upload_view_img" alt="">
                                            <div class="hover_operate">
                                                <span class="btn1icon" nz-icon nzType="eye"
                                                    (click.stop)="handlePreview(elf)" nzTheme="outline"></span>
                                                <span class="btn1icon" (click.stop)="deleteImage(item,'fileList')"
                                                    nz-icon nzType="delete" nzTheme="outline"></span>
                                            </div>
                                        </div>
                                        <div class="upload_body upload_view"
                                            *ngFor="let elf of item.fileListView; let fi=index">
                                            <img [src]="elf.src" class="upload_view_img" alt="">
                                            <div class="hover_operate">
                                                <span class="btn1icon" nz-icon nzType="eye"
                                                    (click.stop)="handlePreview(elf)" nzTheme="outline"></span>
                                                <span class="btn1icon" (click.stop)="deleteImage(item,'fileListView')"
                                                    nz-icon nzType="delete" nzTheme="outline"></span>
                                            </div>
                                        </div>
                                        <div class="upload_body upload_btn"
                                            *ngIf="item.fileList?.length+item.fileListView?.length<1">
                                            <div class="upload_btn_icon">
                                                <span nz-icon nzType="plus" nzTheme="outline"></span>
                                                <div>Upload</div>
                                            </div>
                                            <input type="file" [accept]="allowedFileTypeNames"
                                                (change)="UploadFlieChange($event,item)" class="upload_input" id="">
                                        </div>
                                    </div>
                                </div>
                                <nz-modal [nzVisible]="previewVisible" [nzContent]="modalContent"
                                    (nzOnCancel)="previewVisible = false" [nzFooter]="null">
                                    <ng-template #modalContent>
                                        <img [src]="previewImage" [ngStyle]="{ width: '100%' }" />
                                    </ng-template>
                                </nz-modal>
                            </nz-form-control>
                        </nz-form-item>
                    </ng-container>
                </div>
                <ng-template #combineTpl let-control>
                    <ng-container *ngIf="control.hasError('required')">请填写 {{ control.name }} 字段.
                    </ng-container>
                    <ng-container *ngIf="control.hasError('email')">The {{ control.name }} field is not valid
                    </ng-container>
                </ng-template>
            </div>
        </div>
    </div>
</form>