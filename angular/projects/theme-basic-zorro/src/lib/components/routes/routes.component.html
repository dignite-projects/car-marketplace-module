<!-- <ul class="navbar-nav">
  <ng-container
    *ngFor="let route of routesService.visible$ | async; trackBy: trackByFn"
    [ngTemplateOutlet]="isDropdown(route) ? dropdownLink : defaultLink"
    [ngTemplateOutletContext]="{ $implicit: route }"
  >
  </ng-container>

  <ng-template #defaultLink let-route>
    <li class="nav-item" *abpPermission="route.requiredPolicy">
      <a class="nav-link" [routerLink]="[route.path]"
        ><i *ngIf="route.iconClass" [ngClass]="route.iconClass"></i>
        {{ route.name | abpLocalization }}</a
      >
    </li>
  </ng-template>

  <ng-template #dropdownLink let-route>
    <ng-container *ngIf="route.children?.length">
      <li
        class="nav-item dropdown"
        display="static"
        *abpPermission="route.requiredPolicy"
        (click)="
          rootDropdownExpand[route.name]
            ? (rootDropdownExpand[route.name] = false)
            : (rootDropdownExpand[route.name] = true)
        "
      >
        <a
          class="nav-link dropdown-toggle"
          data-toggle="dropdown"
          aria-haspopup="true"
          aria-expanded="false"
          href="javascript:void(0)"
        >
          <i *ngIf="route.iconClass" [ngClass]="route.iconClass"></i>
          {{ route.name | abpLocalization }}
        </a>
        <div
          #routeContainer
          class="dropdown-menu border-0 shadow-sm"
          (click)="$event.preventDefault(); $event.stopPropagation()"
          [class.d-block]="smallScreen && rootDropdownExpand[route.name]"
        >
          <ng-container
            *ngTemplateOutlet="forTemplate; context: { $implicit: route }"
          ></ng-container>
        </div>
      </li>
    </ng-container>
  </ng-template>

  <ng-template #forTemplate let-route>
    <ng-container *ngFor="let child of route.children">
      <ng-template
        [ngTemplateOutlet]="child.children?.length ? dropdownChild : defaultChild"
        [ngTemplateOutletContext]="{ $implicit: child }"
      ></ng-template>
    </ng-container>
  </ng-template>

  <ng-template #defaultChild let-child>
    <ng-container *ngIf="child.path">
      <div class="dropdown-submenu" *abpPermission="child.requiredPolicy">
        <a class="dropdown-item" [routerLink]="[child.path]" (click)="closeDropdown()">
          <i *ngIf="child.iconClass" [ngClass]="child.iconClass"></i>
          {{ child.name | abpLocalization }}</a
        >
      </div>
    </ng-container>
  </ng-template>

  <ng-template #dropdownChild let-child>
    <div
      class="dropdown-submenu"
      ngbDropdown
      #dropdownSubmenu="ngbDropdown"
      placement="right-top"
      [autoClose]="true"
      *abpPermission="child.requiredPolicy"
    >
      <div ngbDropdownToggle [class.dropdown-toggle]="false">
        <a
          abpEllipsis="210px"
          [abpEllipsisEnabled]="!smallScreen"
          role="button"
          class="btn d-block text-start dropdown-toggle"
        >
          <i *ngIf="child.iconClass" [ngClass]="child.iconClass"></i>
          {{ child.name | abpLocalization }}
        </a>
      </div>
      <div
        #childrenContainer
        class="dropdown-menu dropdown-menu-start border-0 shadow-sm"
        [class.d-block]="smallScreen && dropdownSubmenu.isOpen()"
      >
        <ng-container *ngTemplateOutlet="forTemplate; context: { $implicit: child }"></ng-container>
      </div>
    </div>
  </ng-template>
</ul> -->
<!-- 
<div class="wrapper">
  <ul nz-menu nzMode="inline" nzTheme="dark" [nzInlineCollapsed]="isCollapsed">
    <ng-container
      *ngFor="let route of routesService.visible$ | async; trackBy: trackByFn"
      [ngTemplateOutlet]="isDropdown(route) ? dropdownLink : defaultLink"
      [ngTemplateOutletContext]="{ $implicit: route }"
    >
    </ng-container>
    <ng-template #defaultLink let-route>
      <li
        class="nav-item"
        nz-menu-item
        nz-tooltip
        *abpPermission="route.requiredPolicy"
        [nzTooltipTitle]="isCollapsed ? (route.name | abpLocalization) : ''"
        [routerLink]="[route.path]"
      >
        <span *ngIf="isNzIcon(route.iconClass)" nz-icon [nzType]="route.iconClass"></span>
        <span *ngIf="!isNzIcon(route.iconClass)" nz-icon>
          <i [ngClass]="route.iconClass"></i>
        </span>
        <span>{{ route.name | abpLocalization }}</span>
      </li>
    </ng-template>

    <ng-template #dropdownLink let-route>
      <ng-container *ngIf="route.children?.length">
        <li nz-submenu *abpPermission="route.requiredPolicy">
          <span title class="submenu-title">
            <span *ngIf="isNzIcon(route.iconClass)" nz-icon [nzType]="route.iconClass"></span>
            <span *ngIf="!isNzIcon(route.iconClass)" nz-icon>
              <i [ngClass]="route.iconClass"></i>
            </span>
            <span>{{ route.name | abpLocalization }}</span>
          </span>
          <ng-container
            *ngTemplateOutlet="forTemplate; context: { $implicit: route }"
          ></ng-container>

          <ng-template #forTemplate let-route>
            <ng-container *ngFor="let child of route.children">
              <ng-template
                [ngTemplateOutlet]="child.children?.length ? dropdownChild : defaultChild"
                [ngTemplateOutletContext]="{ $implicit: child }"
              ></ng-template>
            </ng-container>
          </ng-template>

          <ng-template #defaultChild let-child>
            <ng-container *ngIf="child.path">
              <li
                nz-menu-item
                *abpPermission="child.requiredPolicy"
                [routerLink]="[child.path]"
              >
                <span *ngIf="isNzIcon(child.iconClass)" nz-icon [nzType]="child.iconClass"></span>
                <span *ngIf="!isNzIcon(child.iconClass)" nz-icon>
                  <i [ngClass]="child.iconClass"></i>
                </span>
                <span>{{ child.name | abpLocalization }}</span>
              </li>
            </ng-container>
          </ng-template>
          <ng-template #dropdownChild let-child>
            <li nz-submenu *abpPermission="child.requiredPolicy">
              <span title class="submenu-title">
                <span *ngIf="isNzIcon(child.iconClass)" nz-icon [nzType]="child.iconClass"></span>
                <span *ngIf="!isNzIcon(child.iconClass)" nz-icon>
                  <i
                    [ngClass]="child.iconClass"
                  ></i>
                </span>
                <span>{{ child.name | abpLocalization }}</span>
              </span>
              <ng-container
                *ngTemplateOutlet="forTemplate; context: { $implicit: child }"
              ></ng-container>
            </li>
          </ng-template>
        </li>
      </ng-container>
    </ng-template>
  </ul>
</div> -->

<div class="wrapper">
  <ul nz-menu nzMode="inline" nzTheme="dark" [nzInlineCollapsed]="isCollapsed">
    <ng-container *ngTemplateOutlet="menuTpl; context: { $implicit: routeList }"></ng-container>
    <ng-template #menuTpl let-menus>
      <ng-container *ngFor="let menu of menus">
        <ng-container *ngIf="menu.children.length === 0&&menu.path">
          <li nz-menu-item [nzPaddingLeft]="menu.level * 24" *abpPermission="menu.requiredPolicy"
            [routerLink]="[menu.path]" [routerLinkActiveOptions]="{ exact: true }" routerLinkActive="activestyle">
            <span *ngIf="isNzIcon(menu.iconClass)" nz-icon [nzType]="menu.iconClass"></span>
            <span *ngIf="!isNzIcon(menu.iconClass)" nz-icon>
              <i [ngClass]="menu.iconClass"></i>
            </span>
            <span>{{ menu.name | abpLocalization }}</span>
          </li>
        </ng-container>
        <ng-container *ngIf="menu.children.length > 0">
          <li nz-submenu [nzPaddingLeft]="menu.level * 24" *abpPermission="menu.requiredPolicy">
            <span title class="submenu-title">
              <span *ngIf="isNzIcon(menu.iconClass)" nz-icon [nzType]="menu.iconClass"></span>
              <span *ngIf="!isNzIcon(menu.iconClass)" nz-icon>
                <i [ngClass]="menu.iconClass"></i>
              </span>
              <span>{{ menu.name | abpLocalization }}</span>
            </span>
            <ul>
              <ng-container *ngTemplateOutlet="menuTpl; context: { $implicit: menu.children }"></ng-container>
            </ul>
          </li>
        </ng-container>
      </ng-container>
    </ng-template>
  </ul>
</div>